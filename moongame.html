<!DOCTYPE html>
<html lang="en">

<head>
   <script src="moongame/simplex-noise.js"></script>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <style>
      canvas {
         display: block;
         margin: auto;
         background-color: #000;
      }
   </style>
   <title>Moon Patrol</title>
</head>

<body>
   <canvas id="gameCanvas" width="1400" height="900"></canvas>
   <script>
      const canvas = document.getElementById('gameCanvas');
      const ctx = canvas.getContext('2d');

      const player = {
         x: 100,
         y: canvas.height - 100,
         width: 386,
         height: 315,
         speed: 5,
         jumping: false,
         jumpHeight: 100,
         jumpSpeed: 10,
         facingright: true,
         image: new Image(),
      };

      player.image.src = 'moongame/moonbuggy1.png';
      player.height = player.height / 4;
      player.width = player.width / 4;

      const terrain = {
         data: [],
         width: canvas.width,
         segments: 10,
         maxHeight: 250,
         minHeight: 200,
         noise: new SimplexNoise(),
         scrollOffset: 0,
      };

      function generateTerrain() {
         const step = terrain.width / terrain.segments;
         for (let i = 0; i <= terrain.segments; i++) {
            const x = i * step;
            const y =
               canvas.height -
               terrain.minHeight -
               terrain.noise.noise2D(i * 0.25, 0) * terrain.maxHeight;
            terrain.data.push({ x, y });
         }
      }

      generateTerrain();

      function drawTerrain() {
         ctx.beginPath();
         ctx.moveTo(0, canvas.height);
         terrain.data.forEach((point) => {
            ctx.lineTo(point.x, point.y);
         });
         ctx.lineTo(canvas.width, canvas.height);
         ctx.closePath();
         ctx.fillStyle = 'gray';
         ctx.fill();
      }

      function getTerrainHeightAtX(x) {
         const terrainSegmentWidth = terrain.width / terrain.segments;
         const leftIndex = Math.floor(x / terrainSegmentWidth);
         const rightIndex = Math.ceil(x / terrainSegmentWidth);

         if (rightIndex >= terrain.data.length) {
            return terrain.data[terrain.data.length - 1].y;
         }

         const leftPoint = terrain.data[leftIndex];
         const rightPoint = terrain.data[rightIndex];
         const t = (x - leftPoint.x) / terrainSegmentWidth;

         return leftPoint.y + t * (rightPoint.y - leftPoint.y);
      }

      function getTerrainAngleAtX(x) {
         const terrainSegmentWidth = terrain.width / terrain.segments;
         const leftIndex = Math.floor(x / terrainSegmentWidth);
         const rightIndex = Math.ceil(x / terrainSegmentWidth);

         if (rightIndex >= terrain.data.length) {
            return 0;
         }

         const leftPoint = terrain.data[leftIndex];
         const rightPoint = terrain.data[rightIndex];

         return Math.atan2(rightPoint.y - leftPoint.y, rightPoint.x - leftPoint.x);
      }


      const keys = {
         left: false,
         right: false,
         space: false,
      };

      function drawPlayer() {
         ctx.save();

         const terrainAngle = getTerrainAngleAtX(player.x + player.width / 2);

         if (player.facingright) {
            ctx.translate(player.x + player.width / 2, player.y + player.height);
            ctx.rotate(terrainAngle);
            ctx.translate(-player.width / 2, -player.height);
         } else {
            ctx.translate(player.x + player.width / 2, player.y + player.height);
            ctx.rotate(terrainAngle);
            ctx.scale(-1, 1);
            ctx.translate(-player.width / 2, -player.height);
         }


         ctx.drawImage(player.image, 0, 0, player.width, player.height);
         ctx.restore();
      }

      function handleKeyDown(event) {
         switch (event.key) {
            case 'ArrowLeft':
               keys.left = true;
               break;
            case 'ArrowRight':
               keys.right = true;
               break;
            case ' ':
               keys.space = true;
               break;
         }
      }

      function handleKeyUp(event) {
         switch (event.key) {
            case 'ArrowLeft':
               keys.left = false;
               break;
            case 'ArrowRight':
               keys.right = false;
               break;
            case ' ':
               keys.space = false;
               break;
         }
      }

      function updatePlayer() {
         if (keys.left) {
            if (player.x <= 0) return;
            player.x -= player.speed;
            if (player.facingright) {
               player.facingright = false;
            }
         }
         if (keys.right) {
            if (player.x >= canvas.width - player.width) return;
            player.x += player.speed;
            if (!player.facingright) {
               player.facingright = true;
            }
         }
         if (keys.space && !player.jumping) {
            player.jumping = true;
         }

         // Set player's vertical position based on terrain height
         const terrainHeight = getTerrainHeightAtX(player.x + player.width / 2);
         player.y = terrainHeight - player.height;

         if (player.jumping) {
            player.y -= player.jumpSpeed;
            player.jumpHeight -= player.jumpSpeed;
            if (player.jumpHeight <= 0) {
               player.jumping = false;
               player.jumpHeight = 100;
            }
         } else {
            if (player.y < canvas.height - player.height) {
               player.y += player.jumpSpeed;
            }
         }
      }


      function gameLoop() {
         ctx.clearRect(0, 0, canvas.width, canvas.height);

         drawTerrain();
         updatePlayer();
         drawPlayer();

         requestAnimationFrame(gameLoop);
      }

      document.addEventListener('keydown', handleKeyDown);
      document.addEventListener('keyup', handleKeyUp);

      gameLoop();
   </script>
</body>

</html>


<!-- <!DOCTYPE html>
<html lang="en">
<head>
<link rel="stylesheet" href="onoff/styles.css">
   <meta charset="utf-8" />
   <title>HiYallDoin BBQ Rainbow Unicorn</title>
 
   <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
   <script type="text/javascript" src="./rainbowbg.js"></script>
 

</head>
 
<body onload="initialize()">
   <h1></h1>
 
   <div id="canvasDiv">
      It's bad practice (to me) to put your CSS here.  I'd recommend the use of a CSS file! -->
<!-- canvas id="canvasSignature" width="500px" height="500px" style="border:2px solid #000000;"></canvas>
      <canvas id="canvasSignature" style="border:0px solid #000000;overflow:hidden;margin: 0px;display: block"></canvas>
      <div id="boxy">
      <canvas id="boxcanv" style="color:white;width:100;height:100"></canvas>
      </div>
   </div>
   <h1>HiYallDoin BBQ</h1>
</body>
</html> -->